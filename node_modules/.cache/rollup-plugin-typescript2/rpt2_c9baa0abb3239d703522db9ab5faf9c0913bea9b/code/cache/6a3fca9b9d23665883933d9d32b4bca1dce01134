{"code":"import React, { useState, useEffect, useRef, useImperativeHandle } from 'react';\r\nimport { Container, Wrapper, Canvas, Cam, ErrorMsg } from './styles';\r\nexport var Camera = React.forwardRef(function (_a, ref) {\r\n    var _b = _a.facingMode, facingMode = _b === void 0 ? 'user' : _b, _c = _a.aspectRatio, aspectRatio = _c === void 0 ? 'cover' : _c, _d = _a.numberOfCamerasCallback, numberOfCamerasCallback = _d === void 0 ? function () { return null; } : _d, _e = _a.videoSourceDeviceId, videoSourceDeviceId = _e === void 0 ? undefined : _e, _f = _a.errorMessages, errorMessages = _f === void 0 ? {\r\n        noCameraAccessible: 'No camera device accessible. Please connect your camera or try a different browser.',\r\n        permissionDenied: 'Permission denied. Please refresh and give camera permission.',\r\n        switchCamera: 'It is not possible to switch camera to different one because there is only one video device accessible.',\r\n        canvas: 'Canvas is not supported.',\r\n    } : _f;\r\n    var player = useRef(null);\r\n    var canvas = useRef(null);\r\n    var container = useRef(null);\r\n    var _g = useState(0), numberOfCameras = _g[0], setNumberOfCameras = _g[1];\r\n    var _h = useState(null), stream = _h[0], setStream = _h[1];\r\n    var _j = useState(facingMode), currentFacingMode = _j[0], setFacingMode = _j[1];\r\n    var _k = useState(false), notSupported = _k[0], setNotSupported = _k[1];\r\n    var _l = useState(false), permissionDenied = _l[0], setPermissionDenied = _l[1];\r\n    useEffect(function () {\r\n        numberOfCamerasCallback(numberOfCameras);\r\n    }, [numberOfCameras]);\r\n    useImperativeHandle(ref, function () { return ({\r\n        takePhoto: function () {\r\n            var _a, _b, _c, _d;\r\n            if (numberOfCameras < 1) {\r\n                throw new Error(errorMessages.noCameraAccessible);\r\n            }\r\n            if (canvas === null || canvas === void 0 ? void 0 : canvas.current) {\r\n                var playerWidth = ((_a = player === null || player === void 0 ? void 0 : player.current) === null || _a === void 0 ? void 0 : _a.videoWidth) || 1280;\r\n                var playerHeight = ((_b = player === null || player === void 0 ? void 0 : player.current) === null || _b === void 0 ? void 0 : _b.videoHeight) || 720;\r\n                var playerAR = playerWidth / playerHeight;\r\n                var canvasWidth = ((_c = container === null || container === void 0 ? void 0 : container.current) === null || _c === void 0 ? void 0 : _c.offsetWidth) || 1280;\r\n                var canvasHeight = ((_d = container === null || container === void 0 ? void 0 : container.current) === null || _d === void 0 ? void 0 : _d.offsetHeight) || 1280;\r\n                var canvasAR = canvasWidth / canvasHeight;\r\n                var sX = void 0, sY = void 0, sW = void 0, sH = void 0;\r\n                if (playerAR > canvasAR) {\r\n                    sH = playerHeight;\r\n                    sW = playerHeight * canvasAR;\r\n                    sX = (playerWidth - sW) / 2;\r\n                    sY = 0;\r\n                }\r\n                else {\r\n                    sW = playerWidth;\r\n                    sH = playerWidth / canvasAR;\r\n                    sX = 0;\r\n                    sY = (playerHeight - sH) / 2;\r\n                }\r\n                canvas.current.width = sW;\r\n                canvas.current.height = sH;\r\n                var context = canvas.current.getContext('2d');\r\n                if (context && (player === null || player === void 0 ? void 0 : player.current)) {\r\n                    context.drawImage(player.current, sX, sY, sW, sH, 0, 0, sW, sH);\r\n                }\r\n                var imgData = canvas.current.toDataURL('image/jpeg');\r\n                return imgData;\r\n            }\r\n            else {\r\n                throw new Error(errorMessages.canvas);\r\n            }\r\n        },\r\n        switchCamera: function () {\r\n            if (numberOfCameras < 1) {\r\n                throw new Error(errorMessages.noCameraAccessible);\r\n            }\r\n            else if (numberOfCameras < 2) {\r\n                console.error('Error: Unable to switch camera. Only one device is accessible.'); // console only\r\n            }\r\n            var newFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';\r\n            setFacingMode(newFacingMode);\r\n            return newFacingMode;\r\n        },\r\n        getNumberOfCameras: function () {\r\n            return numberOfCameras;\r\n        },\r\n    }); });\r\n    useEffect(function () {\r\n        initCameraStream(stream, setStream, currentFacingMode, videoSourceDeviceId, setNumberOfCameras, setNotSupported, setPermissionDenied);\r\n    }, [currentFacingMode, videoSourceDeviceId]);\r\n    useEffect(function () {\r\n        if (stream && player && player.current) {\r\n            player.current.srcObject = stream;\r\n        }\r\n        return function () {\r\n            if (stream) {\r\n                stream.getTracks().forEach(function (track) {\r\n                    track.stop();\r\n                });\r\n            }\r\n        };\r\n    }, [stream]);\r\n    return (React.createElement(Container, { ref: container, aspectRatio: aspectRatio },\r\n        React.createElement(Wrapper, null,\r\n            notSupported ? React.createElement(ErrorMsg, null, errorMessages.noCameraAccessible) : null,\r\n            permissionDenied ? React.createElement(ErrorMsg, null, errorMessages.permissionDenied) : null,\r\n            React.createElement(Cam, { ref: player, id: \"video\", muted: true, autoPlay: true, playsInline: true, mirrored: currentFacingMode === 'user' ? true : false }),\r\n            React.createElement(Canvas, { ref: canvas }))));\r\n});\r\nCamera.displayName = 'Camera';\r\nvar initCameraStream = function (stream, setStream, currentFacingMode, videoSourceDeviceId, setNumberOfCameras, setNotSupported, setPermissionDenied) {\r\n    var _a;\r\n    // stop any active streams in the window\r\n    if (stream) {\r\n        stream.getTracks().forEach(function (track) {\r\n            track.stop();\r\n        });\r\n    }\r\n    var constraints = {\r\n        audio: false,\r\n        video: {\r\n            deviceId: videoSourceDeviceId ? { exact: videoSourceDeviceId } : undefined,\r\n            facingMode: currentFacingMode,\r\n            width: { ideal: 1920 },\r\n            height: { ideal: 1920 },\r\n        },\r\n    };\r\n    if ((_a = navigator === null || navigator === void 0 ? void 0 : navigator.mediaDevices) === null || _a === void 0 ? void 0 : _a.getUserMedia) {\r\n        navigator.mediaDevices\r\n            .getUserMedia(constraints)\r\n            .then(function (stream) {\r\n            setStream(handleSuccess(stream, setNumberOfCameras));\r\n        })\r\n            .catch(function (err) {\r\n            handleError(err, setNotSupported, setPermissionDenied);\r\n        });\r\n    }\r\n    else {\r\n        var getWebcam = navigator.getUserMedia ||\r\n            navigator.webkitGetUserMedia ||\r\n            navigator.mozGetUserMedia ||\r\n            navigator.mozGetUserMedia ||\r\n            navigator.msGetUserMedia;\r\n        if (getWebcam) {\r\n            getWebcam(constraints, function (stream) {\r\n                setStream(handleSuccess(stream, setNumberOfCameras));\r\n            }, function (err) {\r\n                handleError(err, setNotSupported, setPermissionDenied);\r\n            });\r\n        }\r\n        else {\r\n            setNotSupported(true);\r\n        }\r\n    }\r\n};\r\nvar handleSuccess = function (stream, setNumberOfCameras) {\r\n    navigator.mediaDevices\r\n        .enumerateDevices()\r\n        .then(function (r) { return setNumberOfCameras(r.filter(function (i) { return i.kind === 'videoinput'; }).length); });\r\n    return stream;\r\n};\r\nvar handleError = function (error, setNotSupported, setPermissionDenied) {\r\n    console.error(error);\r\n    //https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\r\n    if (error.name === 'PermissionDeniedError') {\r\n        setPermissionDenied(true);\r\n    }\r\n    else {\r\n        setNotSupported(true);\r\n    }\r\n};\r\n//# sourceMappingURL=Camera.js.map","references":["C:/Users/brurei/Desktop/cd2-camera-integrator/cd2-camera-integrator/node_modules/@types/react/index.d.ts","C:/Users/brurei/Desktop/cd2-camera-integrator/cd2-camera-integrator/src/components/Camera/types.ts","C:/Users/brurei/Desktop/cd2-camera-integrator/cd2-camera-integrator/src/components/Camera/styles.ts"],"map":"{\"version\":3,\"file\":\"Camera.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/components/Camera/Camera.tsx\"],\"names\":[],\"mappings\":\"AAAA,OAAO,KAAK,EAAE,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,mBAAmB,EAAE,MAAM,OAAO,CAAC;AAUhF,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAE,MAAM,UAAU,CAAC;AAErE,MAAM,CAAC,IAAM,MAAM,GAAG,KAAK,CAAC,UAAU,CACpC,UACE,EAYC,EACD,GAAG;QAZD,kBAAmB,EAAnB,UAAU,mBAAG,MAAM,KAAA,EACnB,mBAAqB,EAArB,WAAW,mBAAG,OAAO,KAAA,EACrB,+BAAoC,EAApC,uBAAuB,mBAAG,cAAM,OAAA,IAAI,EAAJ,CAAI,KAAA,EACpC,2BAA+B,EAA/B,mBAAmB,mBAAG,SAAS,KAAA,EAC/B,qBAMC,EAND,aAAa,mBAAG;QACd,kBAAkB,EAAE,qFAAqF;QACzG,gBAAgB,EAAE,+DAA+D;QACjF,YAAY,EACV,yGAAyG;QAC3G,MAAM,EAAE,0BAA0B;KACnC,KAAA;IAIH,IAAM,MAAM,GAAG,MAAM,CAAmB,IAAI,CAAC,CAAC;IAC9C,IAAM,MAAM,GAAG,MAAM,CAAoB,IAAI,CAAC,CAAC;IAC/C,IAAM,SAAS,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;IACzC,IAAA,KAAwC,QAAQ,CAAS,CAAC,CAAC,EAA1D,eAAe,QAAA,EAAE,kBAAkB,QAAuB,CAAC;IAC5D,IAAA,KAAsB,QAAQ,CAAS,IAAI,CAAC,EAA3C,MAAM,QAAA,EAAE,SAAS,QAA0B,CAAC;IAC7C,IAAA,KAAqC,QAAQ,CAAa,UAAU,CAAC,EAApE,iBAAiB,QAAA,EAAE,aAAa,QAAoC,CAAC;IACtE,IAAA,KAAkC,QAAQ,CAAU,KAAK,CAAC,EAAzD,YAAY,QAAA,EAAE,eAAe,QAA4B,CAAC;IAC3D,IAAA,KAA0C,QAAQ,CAAU,KAAK,CAAC,EAAjE,gBAAgB,QAAA,EAAE,mBAAmB,QAA4B,CAAC;IAEzE,SAAS,CAAC;QACR,uBAAuB,CAAC,eAAe,CAAC,CAAC;IAC3C,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC;IAEtB,mBAAmB,CAAC,GAAG,EAAE,cAAM,OAAA,CAAC;QAC9B,SAAS,EAAE;;YACT,IAAI,eAAe,GAAG,CAAC,EAAE;gBACvB,MAAM,IAAI,KAAK,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;aACnD;YAED,IAAI,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,OAAO,EAAE;gBACnB,IAAM,WAAW,GAAG,OAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,OAAO,0CAAE,UAAU,KAAI,IAAI,CAAC;gBACxD,IAAM,YAAY,GAAG,OAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,OAAO,0CAAE,WAAW,KAAI,GAAG,CAAC;gBACzD,IAAM,QAAQ,GAAG,WAAW,GAAG,YAAY,CAAC;gBAE5C,IAAM,WAAW,GAAG,OAAA,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,OAAO,0CAAE,WAAW,KAAI,IAAI,CAAC;gBAC5D,IAAM,YAAY,GAAG,OAAA,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,OAAO,0CAAE,YAAY,KAAI,IAAI,CAAC;gBAC9D,IAAM,QAAQ,GAAG,WAAW,GAAG,YAAY,CAAC;gBAE5C,IAAI,EAAE,SAAA,EAAE,EAAE,SAAA,EAAE,EAAE,SAAA,EAAE,EAAE,SAAA,CAAC;gBAEnB,IAAI,QAAQ,GAAG,QAAQ,EAAE;oBACvB,EAAE,GAAG,YAAY,CAAC;oBAClB,EAAE,GAAG,YAAY,GAAG,QAAQ,CAAC;oBAC7B,EAAE,GAAG,CAAC,WAAW,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;oBAC5B,EAAE,GAAG,CAAC,CAAC;iBACR;qBAAM;oBACL,EAAE,GAAG,WAAW,CAAC;oBACjB,EAAE,GAAG,WAAW,GAAG,QAAQ,CAAC;oBAC5B,EAAE,GAAG,CAAC,CAAC;oBACP,EAAE,GAAG,CAAC,YAAY,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;iBAC9B;gBAED,MAAM,CAAC,OAAO,CAAC,KAAK,GAAG,EAAE,CAAC;gBAC1B,MAAM,CAAC,OAAO,CAAC,MAAM,GAAG,EAAE,CAAC;gBAE3B,IAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;gBAChD,IAAI,OAAO,KAAI,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,OAAO,CAAA,EAAE;oBAC9B,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;iBACjE;gBAED,IAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;gBACvD,OAAO,OAAO,CAAC;aAChB;iBAAM;gBACL,MAAM,IAAI,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;aACvC;QACH,CAAC;QACD,YAAY,EAAE;YACZ,IAAI,eAAe,GAAG,CAAC,EAAE;gBACvB,MAAM,IAAI,KAAK,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;aACnD;iBAAM,IAAI,eAAe,GAAG,CAAC,EAAE;gBAC9B,OAAO,CAAC,KAAK,CAAC,gEAAgE,CAAC,CAAC,CAAC,eAAe;aACjG;YACD,IAAM,aAAa,GAAG,iBAAiB,KAAK,MAAM,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,MAAM,CAAC;YAC5E,aAAa,CAAC,aAAa,CAAC,CAAC;YAC7B,OAAO,aAAa,CAAC;QACvB,CAAC;QACD,kBAAkB,EAAE;YAClB,OAAO,eAAe,CAAC;QACzB,CAAC;KACF,CAAC,EAxD6B,CAwD7B,CAAC,CAAC;IAEJ,SAAS,CAAC;QACR,gBAAgB,CACd,MAAM,EACN,SAAS,EACT,iBAAiB,EACjB,mBAAmB,EACnB,kBAAkB,EAClB,eAAe,EACf,mBAAmB,CACpB,CAAC;IACJ,CAAC,EAAE,CAAC,iBAAiB,EAAE,mBAAmB,CAAC,CAAC,CAAC;IAE7C,SAAS,CAAC;QACR,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,OAAO,EAAE;YACtC,MAAM,CAAC,OAAO,CAAC,SAAS,GAAG,MAAM,CAAC;SACnC;QACD,OAAO;YACL,IAAI,MAAM,EAAE;gBACV,MAAM,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,UAAA,KAAK;oBAC9B,KAAK,CAAC,IAAI,EAAE,CAAC;gBACf,CAAC,CAAC,CAAC;aACJ;QACH,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;IAEb,OAAO,CACL,oBAAC,SAAS,IAAC,GAAG,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW;QACjD,oBAAC,OAAO;YACL,YAAY,CAAC,CAAC,CAAC,oBAAC,QAAQ,QAAE,aAAa,CAAC,kBAAkB,CAAY,CAAC,CAAC,CAAC,IAAI;YAC7E,gBAAgB,CAAC,CAAC,CAAC,oBAAC,QAAQ,QAAE,aAAa,CAAC,gBAAgB,CAAY,CAAC,CAAC,CAAC,IAAI;YAChF,oBAAC,GAAG,IACF,GAAG,EAAE,MAAM,EACX,EAAE,EAAC,OAAO,EACV,KAAK,EAAE,IAAI,EACX,QAAQ,EAAE,IAAI,EACd,WAAW,EAAE,IAAI,EACjB,QAAQ,EAAE,iBAAiB,KAAK,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,GAChD;YACP,oBAAC,MAAM,IAAC,GAAG,EAAE,MAAM,GAAI,CACf,CACA,CACb,CAAC;AACJ,CAAC,CACF,CAAC;AAEF,MAAM,CAAC,WAAW,GAAG,QAAQ,CAAC;AAE9B,IAAM,gBAAgB,GAAG,UACvB,MAAc,EACd,SAAoB,EACpB,iBAA6B,EAC7B,mBAAuC,EACvC,kBAAsC,EACtC,eAAgC,EAChC,mBAAwC;;IAExC,wCAAwC;IACxC,IAAI,MAAM,EAAE;QACV,MAAM,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,UAAA,KAAK;YAC9B,KAAK,CAAC,IAAI,EAAE,CAAC;QACf,CAAC,CAAC,CAAC;KACJ;IAED,IAAM,WAAW,GAAG;QAClB,KAAK,EAAE,KAAK;QACZ,KAAK,EAAE;YACL,QAAQ,EAAE,mBAAmB,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,mBAAmB,EAAE,CAAC,CAAC,CAAC,SAAS;YAC1E,UAAU,EAAE,iBAAiB;YAC7B,KAAK,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE;YACtB,MAAM,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE;SACxB;KACF,CAAC;IAEF,UAAI,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,YAAY,0CAAE,YAAY,EAAE;QACzC,SAAS,CAAC,YAAY;aACnB,YAAY,CAAC,WAAW,CAAC;aACzB,IAAI,CAAC,UAAA,MAAM;YACV,SAAS,CAAC,aAAa,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC,CAAC;QACvD,CAAC,CAAC;aACD,KAAK,CAAC,UAAA,GAAG;YACR,WAAW,CAAC,GAAG,EAAE,eAAe,EAAE,mBAAmB,CAAC,CAAC;QACzD,CAAC,CAAC,CAAC;KACN;SAAM;QACL,IAAM,SAAS,GACb,SAAS,CAAC,YAAY;YACtB,SAAS,CAAC,kBAAkB;YAC5B,SAAS,CAAC,eAAe;YACzB,SAAS,CAAC,eAAe;YACzB,SAAS,CAAC,cAAc,CAAC;QAC3B,IAAI,SAAS,EAAE;YACb,SAAS,CACP,WAAW,EACX,UAAA,MAAM;gBACJ,SAAS,CAAC,aAAa,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC,CAAC;YACvD,CAAC,EACD,UAAA,GAAG;gBACD,WAAW,CAAC,GAAY,EAAE,eAAe,EAAE,mBAAmB,CAAC,CAAC;YAClE,CAAC,CACF,CAAC;SACH;aAAM;YACL,eAAe,CAAC,IAAI,CAAC,CAAC;SACvB;KACF;AACH,CAAC,CAAC;AAEF,IAAM,aAAa,GAAG,UAAC,MAAmB,EAAE,kBAAsC;IAChF,SAAS,CAAC,YAAY;SACnB,gBAAgB,EAAE;SAClB,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,kBAAkB,CAAC,CAAC,CAAC,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,KAAK,YAAY,EAAvB,CAAuB,CAAC,CAAC,MAAM,CAAC,EAAjE,CAAiE,CAAC,CAAC;IAEhF,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;AAEF,IAAM,WAAW,GAAG,UAAC,KAAY,EAAE,eAAgC,EAAE,mBAAwC;IAC3G,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IAErB,4EAA4E;IAC5E,IAAI,KAAK,CAAC,IAAI,KAAK,uBAAuB,EAAE;QAC1C,mBAAmB,CAAC,IAAI,CAAC,CAAC;KAC3B;SAAM;QACL,eAAe,CAAC,IAAI,CAAC,CAAC;KACvB;AACH,CAAC,CAAC\"}","dts":{"name":"C:/Users/brurei/Desktop/cd2-camera-integrator/cd2-camera-integrator/components/Camera/Camera.d.ts","writeByteOrderMark":false,"text":"import React from 'react';\r\nimport { CameraProps } from './types';\r\nexport declare const Camera: React.ForwardRefExoticComponent<CameraProps & React.RefAttributes<unknown>>;\r\n"}}
